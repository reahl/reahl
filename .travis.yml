sudo: required
dist: trusty


addons:
#  postgresql: "9.4"
  apt:
    packages:
       # Basic apt dependencies
        - equivs 
        - openssh-client 
        - dpkg-dev 
#        - chromium-browser 
#        - chromium-chromedriver

       # For compiling pip installed extensions we use
        - python-virtualenv
        - python-dev
        - gcc
        - cython
        - libxml2-dev
        # - libxslt-dev   # not allowed in apt addon
        - libsqlite3-0
        - sqlite3
        - postgresql-server-dev-9.1
        - zlib1g-dev
        - libjpeg62-dev
        - libfreetype6-dev
        - liblcms1-dev

services:
  - postgresql

language: python
python:
  - 3.4
  - 2.7

before_install: 
  - "sudo apt-get install -qq libxslt-dev chromium-chromedriver chromium-browser"
  - "export PATH=$PATH:/usr/lib/chromium-browser/"
  - "gpg --import travis/testkey.public.asc travis/testkey.secret.asc"
  - "gpg --import-ownertrust < travis/testkey.trust.asc"
  - "gpg --list-keys"
  - "gpg --list-secret-keys"
  - "echo $VIRTUALENV"

install:
  - "echo $VIRTUALENV"
  - "breakherefornow "
  - "python scripts/bootstrap.py --script-dependencies"
  - "python scripts/bootstrap.py --pip-installs"
  - "reahl-control createdbuser reahl-web/etc/"
  - "reahl-control createdb reahl-web/etc/"
  - "reahl setup -sX -- develop -N"


before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start

script:
  - "reahl shell -sX -- reahl unit"

